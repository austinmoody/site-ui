<div class="container">
    <div class="row">
        <div class="col-sm-12 sandbox-overview">
            <div class="col-sm-12">
                <h1>C-CDA Validator</h1>
                <p>The goal of the SITE C-CDA Validator is to validate conformance of C-CDA documents to the standard in order to promote interoperability. It is a resource to validate the conformance of C-CDA documents to ONC 2014 and 2015 Certification Editions regulations and objectives, or the base HL7 C-CDA Implementation Guide.</p>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-6" *ngIf="!isValidating">
            <form name="validationForm" #validationForm="ngForm"
                  (ngSubmit)="onSubmit(validationForm.value)"
                  class="form-horizontal">
                <div class="form-group">
                    <label for="messageTypeGroup">Select whether your system is a SENDER or RECEIVER of C-CDA's:</label>
                    <div id="messageTypeGroup">
                        <button class="btn btn-primary" (click)="setSelectedMessageType('sender')">Sender</button>
                        <button class="btn btn-primary" (click)="setSelectedMessageType('receiver')">Receiver</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="validationObjectives">Select ONC 2015 Edition S&CC objective or other C-CDA IG
                        conformance criteria:</label>
                    <select id="validationObjectives" name="validationObjective" class="form-control"
                            (change)="getReferenceFilesForValidationObjective($event.target.value)" tabindex="1"
                            required [(ngModel)]="validationObjective">
                        <option value="">--- select one ---</option>
                        <option *ngFor="let p of validationObjectives" [value]="p.name">{{p.name}}</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="referenceFiles">Select the scenario file that you used to generate the C-CDA, if you are
                        testing a C-CDA generated without using any of the scenario files in the drop down, select "No
                        scenario File":</label>
                    <select id="referenceFiles" name="referenceFileName" class="form-control"
                            tabindex="1" required [(ngModel)]="referenceFileName">
                        <option value="">--- select one ---</option>
                        <option *ngFor="let r of referenceFiles" [value]="r.name">{{r.name}}</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="fileUpload">Upload generated C-CDA file to validate:</label>
                    <input type="file" id="fileUpload" (change)="fileChangeEvent($event)" class="form-control" tabindex="1" required/>
                </div>
                <div class="form-group">
                    <label for="validationSubmit">Validate Document</label>
                    <div id="validationSubmit">
                        <button type="submit" class="btn btn-primary" [disabled]="!validationForm.form.valid">
                           Submit
                        </button>
                    </div>
                </div>
            </form>
        </div>
        <div class="col-sm-6" *ngIf="isValidating">
            <div class="blockMsg">
                <i class="fa fa-spinner fa-spin fa-3x fa-fw" aria-hidden="true"></i>
                <div>
                    <h1>Validating</h1>
                    <h3>{{filesToUpload[0].name}}</h3>
                </div>
            </div>
        </div>
        <div class="col-sm-6">
            <div class="well pre-scrollable">
                <h3>1.0.4 Release Notes</h3>
                <ul class="list-group">
                    <li class="list-group-item">See ETT related errata 1017 and 1045 (implementation requested or errata
                        created via discussion in ETT forum)
                    </li>
                    <li class="list-group-item">Fixed typeCode identification issue for performers in Continuity Of Care
                        Document level validations
                    </li>
                    <li class="list-group-item">1017, 1038, 1045 ERRATA</li>
                    <li class="list-group-item">Adds multiple rules which, among other things, allows additional
                        effectiveTime elements in Planned Medication Activity (such as one to record frequency) as long
                        as one of them is of type IVL_TS or TS
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-6">
            <div class="well">
                <h3>Links to C-CDA Reference Information</h3>
                <a class="btn btn-default" href="http://www.hl7.org/implement/standards/product_brief.cfm?product_id=408" style="width: 100%;" tabindex="1" target="_blank">C-CDA R2.1 Product
                    Page</a> <span class="external-page embedded"><a class="ext-icon"
                                                                     href="http://www.hhs.gov/disclaimer.html"
                                                                     tabindex="1" target="_blank"
                                                                     title="Web Site Disclaimers"><span
                        class="hiddenText">Web Site Disclaimers</span></a></span> <a class="btn btn-default"
                                                                                     href="http://wiki.siframework.org/Companion+Guide+to+Consolidated+CDA+for+MU2"
                                                                                     style="width: 100%;" tabindex="1"
                                                                                     target="_blank">S&amp;I Framework
                    C-CDA Companion Guide for MU2</a> <span class="external-page embedded"><a class="ext-icon"
                                                                                              href="http://www.hhs.gov/disclaimer.html"
                                                                                              tabindex="1"
                                                                                              target="_blank"
                                                                                              title="Web Site Disclaimers"><span
                        class="hiddenText">Web Site Disclaimers</span></a></span> <a class="btn btn-default"
                                                                                     href="https://hit-dev.nist.gov:11081/ttt/#/validators"
                                                                                     style="width: 100%;" tabindex="1"
                                                                                     target="_blank">NIST C-CDA R2.1
                    Validator</a><span class="external-page embedded"><a class="ext-icon"
                                                                         href="http://www.hhs.gov/disclaimer.html"
                                                                         tabindex="1" target="_blank"
                                                                         title="Web Site Disclaimers"><span
                        class="hiddenText">Web Site Disclaimers</span></a></span> <a class="btn btn-default"
                                                                                     href="http://ccda-scorecard.smartplatforms.org/static/ccdaScorecard/#/"
                                                                                     style="width: 100%; " tabindex="1"
                                                                                     target="_blank">SMART C-CDA
                    Scorecard</a> <span class="external-page embedded"><a class="ext-icon"
                                                                          href="http://www.hhs.gov/disclaimer.html"
                                                                          tabindex="1" target="_blank"
                                                                          title="Web Site Disclaimers"><span
                        class="hiddenText">Web Site Disclaimers</span></a></span>

            </div>
        </div>
        <div class="col-sm-6">
            <div class="well">
                <h3> Relationship to NIST C-CDA Validator</h3>
                <p>
                    The NIST C-CDA Validator for ONC 2014 and 2015 Certification Editions and this version of the C-CDA
                    validator are both
                    based on the Model Driven Health Tools (MDHT) software. The SITE C-CDA Validator's agile development
                    process adopts bug
                    fixes more quickly and provides additional enhancements that may not be required for the NIST C-CDA
                    Validator.
                    Ensuring that a document passes the SITE C-CDA Validator validation will improve the quality of
                    C-CDA documents produced,
                    and promote interoperability.
                </p>
            </div>
        </div>
    </div>

    <modal #resultsModal cssClass="validation-modal-dialog">
        <modal-header>
            <ul class="nav nav-tabs" id="resultModalTabs">
                <li><a href="#results-group-tab" data-toggle="tab">Validation Result</a></li>
                <li><a href="#results-xml-tab" data-toggle="tab">Original C-CDA</a></li>
                <li class="pull-right"><button type="button" class="btn btn-primary" (click)="modal.close()">Close</button> </li>
            </ul>
        </modal-header>
        <modal-body>
            <div class="tab-content">
                <div role="tabpanel" class="tab-pane active" id="results-group-tab" >
                    <div class="row">
                        <div class="col-sm-4">
                            <div class="list-group">
                                <div class="list-group-item"
                                     *ngFor="let r of validationResults?.resultsMetaData.resultMetaData.slice(0, 3)">
                                    <span [ngClass]="'badge ' + getValidationClassFotType(r.type)">{{r.count}}</span>
                                    <button type="button" class="btn btn-link" (click)="scrollInside('#'+r.type)">{{r.type}}</button>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-4">
                            <div class="list-group">
                                <div class="list-group-item"
                                     *ngFor="let r of validationResults?.resultsMetaData.resultMetaData.slice(3, 6)">
                                    <span [ngClass]="'badge ' + getValidationClassFotType(r.type)">{{r.count}}</span>
                                    <button type="button" class="btn btn-link"  (click)="scrollInside('#'+r.type)">{{r.type | hyphenateString}}</button>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-4">
                            <div class="list-group">
                                <div class="list-group-item"
                                     *ngFor="let r of validationResults?.resultsMetaData.resultMetaData.slice(6, 9)">
                                    <span [ngClass]="'badge ' + getValidationClassFotType(r.type)">{{r.count}}</span>
                                    <button type="button" class="btn btn-link"  (click)="scrollInside('#'+r.type)">{{r.type}}</button>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="pre-scrollable results-group" id="groupedResults" #groupedResults>
                        <span *ngFor="let r of validationResults?.ccdaValidationResults; let i = index" [ngClass]="getValidationClassFotType(r.type)">
                            <h1 *ngIf(newResultType(r.type)) id="{{r.type | hyphenateString}}">{{r.type}}</h1>
                            <span>
                                <ul>
                                    <li class=""><b>Result Description:</b> {{r.description}}</li>
                                    <li class=""><b>Document Xpath:</b> {{r.xPath}}</li>
                                    <li class=""><b>Document Line Number:</b> {{r.documentLineNumber}}</li>
                                </ul>
                            </span>
                        </span>
                    </div>
                </div>
                <div role="tabpanel" class="tab-pane" id="results-xml-tab" #xmlHighlightedResults></div>
            </div>
        </modal-body>
        <modal-footer>
            <button type="button" class="btn btn-primary" (click)="modal.close()">Close</button>
        </modal-footer>
    </modal>
</div>

